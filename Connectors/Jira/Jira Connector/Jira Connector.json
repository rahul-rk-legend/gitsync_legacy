{
    "isUpdateAvailable": false,
    "isCustom": false,
    "isEnabled": false,
    "isRemoteConnector": false,
    "environment": "Default Environment",
    "integration": "Jira",
    "identifier": "Jira Connector_1af15240-e516-4898-b208-a747c61c83ba",
    "connectorDefinitionName": "Jira Connector",
    "displayName": "Jira Connector",
    "description": "Fetch issues from Jira to Siemplify",
    "runIntervalInSeconds": 10,
    "resultDataType": 0,
    "version": "1",
    "pythonVersion": 3,
    "isAllowlistSupported": false,
    "params": [
        {
            "connectorIdentifier": null,
            "paramName": "Use Jira Project as Environment",
            "paramValue": "false",
            "description": "Use Jira project as environment else use Environment Field Name as environment.",
            "type": 0,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": false,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Environment Field Name",
            "paramValue": "",
            "description": "Describes the name of the field where the environment name is stored. If the environment field isn't found, the environment is the default environment.",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Days Backwards",
            "paramValue": "1",
            "description": "Max number of days backwards to pull alerts from",
            "type": 1,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": false,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Project Names",
            "paramValue": "kanban project",
            "description": "Project names separated by comma",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Proxy Server Address",
            "paramValue": "",
            "description": "The address of the proxy server to use.",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Script Timeout (Seconds)",
            "paramValue": "180",
            "description": "The timeout limit (in seconds) for the python process running current script",
            "type": 2,
            "mode": 0,
            "isDisplayed": true,
            "isMandatory": true,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Api Root",
            "paramValue": "https://google-team-gcr2cbk8.atlassian.net",
            "description": "The API root of the JIRA instance",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": true,
            "isAdvanced": false,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Username",
            "paramValue": "marthasahithya@google.com",
            "description": "Username",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": true,
            "isAdvanced": false,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Api Token",
            "paramValue": "***************",
            "description": "Api Token",
            "type": 3,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": true,
            "isAdvanced": false,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Proxy Password",
            "paramValue": "",
            "description": "The proxy password to authenticate with.",
            "type": 3,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Environment Regex Pattern",
            "paramValue": ".*",
            "description": "A regex pattern to run on the value found in the \"Environment Field Name\" field. Default is .* to catch all and return the value unchanged. Used to allow the user to manipulate the environment field via regex logic. If the regex pattern is null or empty, or the environment value is null, the final environment result is the default environment.",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Max Tickets Per Cycle",
            "paramValue": "2",
            "description": "Max tickets to fetch and process in one connector cycle",
            "type": 1,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": false,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Verify SSL",
            "paramValue": "false",
            "description": "If enabled, verify the SSL certificate for the connection to Jira server is valid.",
            "type": 0,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": false,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Issue Statuses",
            "paramValue": "",
            "description": "Issue statuses separated by comma",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Assignees",
            "paramValue": "",
            "description": "Users full names separated by comma",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Issue Types",
            "paramValue": "",
            "description": "Issue types separated by comma",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Issue Priorities",
            "paramValue": "",
            "description": "Issue priorities separated by comma",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Issue Components",
            "paramValue": "",
            "description": "Issue components separated by comma",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        },
        {
            "connectorIdentifier": null,
            "paramName": "Proxy Username",
            "paramValue": "",
            "description": "The proxy username to authenticate with.",
            "type": 2,
            "mode": 2,
            "isDisplayed": true,
            "isMandatory": false,
            "isAdvanced": true,
            "id": 0,
            "creationTimeUnixTimeInMs": 0,
            "modificationTimeUnixTimeInMs": 0
        }
    ],
    "allowList": [],
    "integrationVersion": 50.0,
    "isScriptConnector": true,
    "script": "import sys\nfrom datetime import timezone\n\nfrom TIPCommon import (\n    extract_connector_param,\n    siemplify_save_timestamp,\n    get_last_success_time,\n    is_overflowed,\n    read_ids,\n    write_ids,\n)\nfrom EnvironmentCommon import GetEnvironmentCommonFactory\n\nfrom JiraConstants import JIRA_TIME_FORMAT, DEFAULT_TIMEOUT_IN_SECONDS\nfrom JiraManager import JiraManager\nfrom SiemplifyConnectors import SiemplifyConnectorExecution\nfrom SiemplifyUtils import output_handler\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime\nfrom utils import load_csv_to_list, is_approaching_timeout\n\nconnector_starting_time = unix_now()\n\n# CONSTANTS\nDEFAULT_DAYS_BACKWARDS = 10\nMAX_TICKETS_PER_CYCLE = 10\n\n\n@output_handler\ndef main(is_test_run):\n    siemplify = SiemplifyConnectorExecution()\n    all_tickets = []\n    processed_alerts = []\n\n    if is_test_run:\n        siemplify.LOGGER.info(\n            '***** This is an \"IDE Play Button\"\\\\\"Run Connector once\" test run ******'\n        )\n\n    siemplify.LOGGER.info(\"------------------- Main - Param Init -------------------\")\n\n    # Connector configurations\n    api_root = extract_connector_param(\n        siemplify, param_name=\"Api Root\", is_mandatory=True, print_value=True\n    )\n    username = extract_connector_param(\n        siemplify, param_name=\"Username\", is_mandatory=True, print_value=True\n    )\n    api_token = extract_connector_param(\n        siemplify, param_name=\"Api Token\", is_mandatory=True, print_value=False\n    )\n    use_jira_as_env = extract_connector_param(\n        siemplify,\n        param_name=\"Use Jira Project as Environment\",\n        is_mandatory=False,\n        input_type=bool,\n        default_value=True,\n        print_value=True,\n    )\n    verify_ssl = extract_connector_param(\n        siemplify,\n        param_name=\"Verify SSL\",\n        default_value=False,\n        input_type=bool,\n        is_mandatory=False,\n    )\n    days_backwards = extract_connector_param(\n        siemplify,\n        param_name=\"Days Backwards\",\n        input_type=int,\n        default_value=DEFAULT_DAYS_BACKWARDS,\n        is_mandatory=False,\n        print_value=True,\n    )\n    max_tickets_per_cycle = extract_connector_param(\n        siemplify,\n        param_name=\"Max Tickets Per Cycle\",\n        input_type=int,\n        default_value=MAX_TICKETS_PER_CYCLE,\n        is_mandatory=False,\n        print_value=True,\n    )\n    python_process_timeout = extract_connector_param(\n        siemplify,\n        param_name=\"PythonProcessTimeout\",\n        input_type=int,\n        is_mandatory=True,\n        default_value=DEFAULT_TIMEOUT_IN_SECONDS,\n        print_value=True,\n    )\n\n    issue_statuses = extract_connector_param(\n        siemplify, param_name=\"Issue Statuses\", is_mandatory=False, print_value=True\n    )\n    project_names = extract_connector_param(\n        siemplify, param_name=\"Project Names\", is_mandatory=False, print_value=True\n    )\n    assign_users = extract_connector_param(\n        siemplify, param_name=\"Assignees\", is_mandatory=False, print_value=True\n    )\n    issue_types = extract_connector_param(\n        siemplify, param_name=\"Issue Types\", is_mandatory=False, print_value=True\n    )\n    issue_priorities = extract_connector_param(\n        siemplify, param_name=\"Issue Priorities\", is_mandatory=False, print_value=True\n    )\n    issue_components = extract_connector_param(\n        siemplify, param_name=\"Issue Components\", is_mandatory=False, print_value=True\n    )\n\n    environment_field_name = extract_connector_param(\n        siemplify,\n        param_name=\"Environment Field Name\",\n        is_mandatory=False,\n        default_value=\"\",\n        print_value=True,\n    )\n    environment_regex_pattern = extract_connector_param(\n        siemplify,\n        param_name=\"Environment Regex Pattern\",\n        print_value=True,\n        is_mandatory=False,\n    )\n\n    common_environment = GetEnvironmentCommonFactory().create_environment_manager(\n        siemplify, environment_field_name, environment_regex_pattern\n    )\n\n    labels = siemplify.whitelist\n\n    try:\n        if max_tickets_per_cycle <= 0:\n            raise Exception(\n                '\"Max Tickets Per Cycle must be\" must be a positive number.'\n            )\n\n        issue_statuses = (\n            load_csv_to_list(issue_statuses, \"Issue Statuses\")\n            if issue_statuses\n            else None\n        )\n        project_names = (\n            load_csv_to_list(project_names, \"Project Names\") if project_names else None\n        )\n        assign_users = (\n            load_csv_to_list(assign_users, \"Assignees\") if assign_users else None\n        )\n        issue_types = (\n            load_csv_to_list(issue_types, \"Issue Types\") if issue_types else None\n        )\n        issue_priorities = (\n            load_csv_to_list(issue_priorities, \"Issue Priorities\")\n            if issue_priorities\n            else None\n        )\n        issue_components = (\n            load_csv_to_list(issue_components, \"Issue Components\")\n            if issue_components\n            else None\n        )\n\n        jira_manager = JiraManager(\n            api_root,\n            username,\n            api_token,\n            verify_ssl=verify_ssl,\n            logger=siemplify.LOGGER,\n        )\n\n        # Read already existing alert ids from ids.json file\n        siemplify.LOGGER.info(\"Loading existing ids from IDS file.\")\n        existing_ids = read_ids(siemplify)\n        siemplify.LOGGER.info(f\"Found {len(existing_ids)} existing ids in ids.json\")\n\n        last_success_time = get_last_success_time(\n            siemplify=siemplify, offset_with_metric={\"days\": days_backwards}\n        )\n\n        # Convert last_success_time from UTC to JIRA server's timezone,\n        # as JIRA doesn't support timezone in the JQL query\n        # and searches applied using the server's timezone.\n        jira_server_time = jira_manager.get_server_time()\n        siemplify.LOGGER.info(f\"JIRA server time: {jira_server_time.isoformat()}\")\n        last_run = last_success_time.replace(tzinfo=timezone.utc).astimezone(\n            jira_server_time.tzinfo\n        )\n        siemplify.LOGGER.info(\n            f\"Adjusted last success time to server time: {last_run.isoformat()}\"\n        )\n\n        # Get alerts\n        siemplify.LOGGER.info(\"Collecting tickets...\")\n        tickets = jira_manager.list_issues(\n            project_key_list=project_names,\n            updated_from=last_run.strftime(JIRA_TIME_FORMAT),\n            assignee_list=assign_users,\n            issue_type_list=issue_types,\n            priority_list=issue_priorities,\n            labels_list=labels,\n            components_list=issue_components,\n            only_keys=False,\n            status_list=issue_statuses,\n            order_by=\"updated\",\n            asc=True,\n            existing_ids=existing_ids,\n            limit=max_tickets_per_cycle,\n        )\n        tickets = sorted(tickets, key=lambda ticket: ticket.updated_ms)\n        siemplify.LOGGER.info(f\"Successfully fetched {len(tickets)} tickets\")\n\n        if is_test:\n            siemplify.LOGGER.info(\"This is a TEST run. Only 1 alert will be processed.\")\n            tickets = tickets[:1]\n\n        for ticket in tickets:\n            try:\n                if len(processed_alerts) >= max_tickets_per_cycle:\n                    # Provide slicing for the alerts amount.\n                    siemplify.LOGGER.info(\n                        f\"{len(processed_alerts)} tickets were processed. Stopping connector\"\n                    )\n                    break\n\n                if is_approaching_timeout(\n                    python_process_timeout, connector_starting_time\n                ):\n                    siemplify.LOGGER.info(\n                        \"Timeout is approaching. Connector will gracefully exit\"\n                    )\n                    break\n\n                # Update existing alerts\n                existing_ids.append(ticket.key)\n                all_tickets.append(ticket)\n\n                siemplify.LOGGER.info(f\"Processing ticket {ticket.key}\")\n                # Create alert info\n                alert_info = ticket.get_alert_info(\n                    ticket, common_environment, siemplify.LOGGER, use_jira_as_env\n                )\n\n                if is_overflowed(siemplify, alert_info, is_test_run):\n                    siemplify.LOGGER.info(\n                        f\"{alert_info.rule_generator}-{alert_info.ticket_id}-{alert_info.environment}-{alert_info.device_product} found as overflow alert. Skipping.\"\n                    )\n                    # If is overflowed we should skip\n                    continue\n\n                processed_alerts.append(alert_info)\n                siemplify.LOGGER.info(f\"Ticket {ticket.key} was created.\")\n\n            except Exception as error:\n                siemplify.LOGGER.error(f\"Failed to process ticket {ticket.key}\")\n                siemplify.LOGGER.exception(error)\n                if is_test:\n                    raise\n\n            siemplify.LOGGER.info(\"Completed processing issues.\")\n\n        if not is_test:\n            if all_tickets:\n                new_timestamp = all_tickets[-1].updated_ms\n                siemplify.LOGGER.info(\n                    f\"Saving timestamp of {convert_unixtime_to_datetime(new_timestamp).isoformat()}. Unix: {new_timestamp}\"\n                )\n                siemplify_save_timestamp(\n                    siemplify=siemplify, new_timestamp=new_timestamp\n                )\n            siemplify.LOGGER.info(\"Saving existing ids.\")\n            write_ids(siemplify, existing_ids)\n\n    except Exception as error:\n        siemplify.LOGGER.error(f\"Got exception on main handler. Error: {error}\")\n        siemplify.LOGGER.exception(error)\n        if is_test:\n            raise\n\n    siemplify.LOGGER.info(f\"Created total of {len(processed_alerts)} cases\")\n    siemplify.LOGGER.info(\"------------------- Main - Finished -------------------\")\n    siemplify.return_package(processed_alerts)\n\n\nif __name__ == \"__main__\":\n    is_test = not (len(sys.argv) < 2 or sys.argv[1] == \"True\")\n    main(is_test)\n",
    "documentationLink": "https://cloud.google.com/chronicle/docs/soar/marketplace-integrations/jira#jira_connector",
    "deviceProductField": "device_product",
    "eventNameField": "issuetype_name",
    "connectorStatus": {
        "connectorIdentifier": "Jira Connector_1af15240-e516-4898-b208-a747c61c83ba",
        "connectivityStatus": 1,
        "amountAlertsInLastDay": 6,
        "avgAlertsPerDay": 6
    },
    "isNew": false,
    "agentIdentifier": null
}